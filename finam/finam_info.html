<html>
<head>
	<script language="javascript">
		var tickets = [
			{ title: 'НЛМК', id: 17046, cat: 7},
			{ title: 'ММК', id: 16782, cat: 7},
			{ title: 'ГМКНорНик', id: 795, cat: 7},
			{ title: 'Мечел', id: 21018, cat: 7},
            			{ title: 'Северсталь', id: 16136, cat: 7},
			{ title: 'ОГК-2', id: 18684, cat: 7},
			//{ title: 'МРСК Холдинг', id: 20971, cat: 7},//делистинг
			{ title: 'Русгидро', id: 20266, cat: 7},
			{ title: 'Газпром', id: 16842, cat: 7},
			{ title: 'Новатек', id: 17370, cat: 7},
			{ title: 'Роснефть', id: 17273, cat: 7},
		            { title: 'Татнефть', id: 825, cat: 7},
		            { title: 'Сургутнефтегаз', id: 4, cat: 7},
		            { title: 'Сургутнефтегаз-п', id: 13, cat: 7},
			{ title: 'Лукойл', id: 8, cat: 7},
		            { title: 'Транснефть ап', id: 1012, cat: 7},
                       
            { title: 'Сбербанк', id: 3, cat: 7},
            { title: 'ВТБ', id: 19043, cat: 7},
            { title: 'АЛРОСА', id: 81820, cat: 7},
	    { title: 'Магнит', id: 17086, cat: 7},
	    { title: 'МТС', id: 15523, cat: 7},
	    { title: 'Мегафон АО', id: 152516, cat: 7},
	    { title: 'ФосАгро ао', id: 81114, cat: 7},
                       
	    { title: 'Аэрофлот', id: 29, cat: 7},
            //{ title: 'Уркалий', id: 19623, cat: 7}, // делистинг
            { title: 'Распадская', id: 17713, cat: 7},
			{ title: 'Нефть', id: 19473, cat: 7},
			{ title: 'Золото', id: 18953, cat: 7},
			{ title: 'ММВБ', id: 13851, cat: 7},
			{ title: 'РТС', id: 17455, cat: 7},
			{ title: 'S&P500', id: 90, cat: 7},
            { title: 'EUR\\USD', id: 83, cat: 7},
            { title: 'USD\\RUB', id: 901, cat: 7},
            { title: 'EUR\\RUB', id: 66860, cat: 7}

		];
		function buildImgTag(id, freq, cat, cellIndex){
			var url = 'http://node.finam.ru/imcf3.asp?id=' + id + '&type=3&ma=6&maval=7&freq=' + freq + '&uf=1&indval=&cat=' + cat + '&cai=7&cat=4&cai=7&v=&idxf=&curr=0&mar=1&gifta_mode=1';
			var img=new Image();
			img.widht = 400;
			img.height = 600;
			img.src=url;
			img.onerror= function(){
				buildImgTag(id, freq, cat, cellIndex);
			};
			img.onload = function() {
         					var container = document.getElementById(id);
         					container.rows[0].childNodes[cellIndex].appendChild(this);
    			};
		}
		function buildItem(item){
			var res = "<h3>"+item.title+"</h3>";
			     res+="<table border='0' id='" + item.id + "'>" + "<tr>";
			     	res+="<td>&nbsp;</td>";
				res+="<td>&nbsp;</td>";
				res+="<td>&nbsp;</td>";
			     res+="</tr></table>";
			     res+="<br />";
			     return res;
		}
		function  build(){
			var res = "";
			for(var i = 0; i < tickets.length; i++){
				res+=buildItem(tickets[i]);	
			}
			document.write(res);
			for(var i = 0; i < tickets.length; i++){
				buildImgTag(tickets[i].id,5,tickets[i].cat, 0);//day
				buildImgTag(tickets[i].id,6,tickets[i].cat, 1);//week
				buildImgTag(tickets[i].id,7,tickets[i].cat, 2);//month
			}
		}

	</script>
</head>
<body onload="build()">
</body>
</html>
